name: override-hooks
type: shell
commands:
  - sed -i '/^#/!s/HOOKS=(.*)/HOOKS=(base udev btrfs autodetect microcode modconf kms keyboard keymap consolefont encrypt block lvm2 filesystems fsck)/g' /etc/mkinitcpio.conf
modules:
  - name: move-boot-scripts
    type: shell
    commands:
      - mkdir -p /usr/libexec/
      - mv /usr/bin/grub-mkconfig /usr/libexec/
      - mv /usr/bin/grub-mkconfig-replacement /usr/local/bin/grub-mkconfig
      - chmod +x /usr/local/bin/grub-mkconfig
      - mv /usr/bin/update-grub /usr/libexec/
      - chmod +x /usr/libexec/update-grub
      - mv /usr/bin/update-grub-replacement /usr/bin/update-grub
      - chmod +x /usr/bin/update-grub
  - name: add-execute-rules-to-lpkg
    type: shell
    commands:
      - chmod +x /usr/bin/lpkg
  - name: remove-grub-files
    type: shell
    commands:
      - rm /etc/grub.d/10_linux
      - rm /etc/grub.d/20_linux_xen